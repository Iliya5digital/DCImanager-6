Статья содержит инструкции по переносу платформы на другой сервер. Если платформа и локация находятся на одном сервере, локация будет перенесена вместе с платформой.

Если вам нужно перенести локацию на новый сервер, выполните действия из статьи базы знаний Если нужно переустановить ОС или заменить сервер-локацию.

Порядок переносаLink to Порядок переноса
Чтобы перенести платформу на другой сервер:

Сгенерируйте новый токен в личном кабинете my.ispsystem.com.
На исходном сервере:
Измените токен для параметра LicenseToken в файле конфигурации /opt/ispsystem/dci/config.json.
Выполните резервное копирование:

dci backup
Резервная копия будет сохранена в директории /opt/ispsystem/dci/backup.

Остановите сервис DCImanager 6:

dci down
Перенесите файл с архивом на сервер назначения:

 rsync -avzP /opt/ispsystem/dci/backup/<имя_файла_архива> user@1.2.3.4:/root/ 
 Пояснения
1.2.3.4 — IP-адрес сервера назначения;

user — имя пользователя на сервере назначения;

<имя_файла_архива> — файл архива в формате .tar.gz.


Обратите внимание!

Утилита rsync должна быть установлена и на исходном сервере, и на сервере назначения.

На сервере назначения:
Подключитесь к серверу по SSH с правами суперпользователя (по умолчанию root).
Скачайте установщик: 

curl -O https://download.ispsystem.com/6/dci/dcibox/dci
Сделайте его исполняемым: 

chmod +x dci
Запустите восстановление:

./dci restore -b /root/<имя_файла_архива>
 Пояснения
<имя_файла_архива> — файл архива в формате .tar.gz.


Обратите внимание!

Обязательно укажите полный путь к файлу архива.

После окончания установки перенесите с исходного сервера директорию /opt/ispsystem/dci/clickhouse_storage:

rsync -avzP user@1.2.3.4:/opt/ispsystem/dci/clickhouse_storage /opt/ispsystem/dci
 Пояснения
user — имя пользователя на исходном сервере;

1.2.3.4 — IP-адрес исходного сервера.

Сделайте установщик сервисом:

./dci make-service
После завершения переноса DCImanager 6 на новый сервер зайдите в интерфейс → Обзор системы → Обновить лицензию.

Раздел "Обзор системы"

Если перенос завершился успешно, удалите платформу с исходного сервера:
Остановите и удалите из автозагрузки службу DCImanager 6: 

systemctl stop dci.service
systemctl disable dci.service
Удалите информацию о работе платформы: 

rm /opt/ispsystem/dci -rf
Удалите установленные docker-образы и контейнеры: 

docker system prune -a -f
