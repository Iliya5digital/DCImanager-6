В статье описан порядок установки платформы на серверы без доступа к сети Интернет. Для установки платформы в закрытом контуре подготавливаются индивидуальные образы c программным обеспечением (ПО). 

Образы содержат репозиторий с шаблонами:

операционных систем
AlmaLinux 8.8;
Astra Linux Special Edition 1.7.3;
Astra Linux Special Edition 1.7.4;
Windows Server 2022; 
диагностики сервера Diag6;
восстановления сервера Sysrescd6-x86_64;
автодобавления серверов Server-search6.
Возможна установка платформы из образа в формате:

ISO;
виртуальной машины (virtual appliance).
Чтобы получить образ для установки, отправьте запрос в личный кабинет ISPsystem или на электронную почту help@ispsystem.ru.


Установка в закрытом контуре доступна только для лицензий Infrastructure. 

Установка из ISO-образа возможна только на сервер с ОС Astra Linux Special Edition 1.7.3, 1.7.4 редакции "Орёл".

Установка из ISO-образаLink to Установка из ISO-образа
Подготовка серверов
Проверьте сервер платформы и локации на соответствие системным требованиям. Подробнее см. в статьях Требования к серверу и Локации. Общая информация.
Установите ОС на сервер платформы и локации. При установке ОС:
На шаге Установка базовой системы выберите ядро linux-5.15-generic.
На шаге Выбор программного обеспечения выберите Консольные утилиты, Средства фильтрации сетевых пакетов ufw, Средства удаленного подключения SSH.
На шаге Дополнительные настройки ОС:
Выберите Базовый уровень защищенности "Орел".
Включите опции Запрет трассировки ptrace, Запрос пароля для команды sudo.
После установки ОС:
Включите пользователя root и установите для него пароль.
Настройте статический IP-адрес на сетевом интерфейсе.
Подготовьте внешний носитель с файлом ISO-образа платформы.
Установка платформы
Подключитесь к серверу по SSH с правами пользователя root. 
Подключите ISO-образ платформы: 

mount -t iso9660 <path_to_iso> /mnt
 Пояснения к команде
<path_to_iso> — путь к файлу ISO-образа. Например, /dev/sr0/dci6.iso

Запустите скрипт установки: 

cd /mnt && sh install_master.sh
Дождитесь окончания установки. Если установка завершилась успешно, то в терминале будет выведена ссылка для перехода в платформу и URL репозитория с образами ОС:

Пример сообщения об успешной установке

"Done. DCImanager 6 login page: https://192.0.2.1/"
 "Username: admin@example.com"
 "Password: q1w2e3r4"
 "Change password after initial"  
 "Almalinux 8 and Astra linux Orel repository mirror: http://192.0.2.1:8081/"
Перейдите в интерфейс платформы по полученной ссылке и укажите данные первого пользователя.
После установки платформа будет доступна по IP-адресу или доменному имени вашего сервера.

Настройка локации
Если в качестве сервера-локации будет использоваться ВМ с платформой, авторизуйтесь в платформе и выполните начальную настройку.

Если локация будет установлена на отдельный сервер:

Подключитесь к серверу по SSH с правами пользователя root. 
Подключите ISO-образ платформы: 

mount -t iso9660 <path_to_iso> /mnt
 Пояснения к команде
<path_to_iso> — путь к файлу ISO-образа. Например, /dev/sr0/dci6.iso

Запустите скрипт установки: 

cd /mnt && sh install_location.sh
Дождитесь окончания установки. Если установка завершилась успешно, то в терминале появится сообщение вида:

===> Чт мар 30 15:09:58 UTC 2023 Done
Подключите локацию к платформе. Подробнее см. в статье Управление локациями.
Подключение репозитория
Подключите ISO-образ с репозиторием: 

mount -t iso9660 <path_to_iso> /mnt
 Пояснения к команде
<path_to_iso> — путь к файлу ISO-образа. Например, /dev/sr0/dci6_repo.iso

Запустите скрипт установки: 

cd /mnt && bash install.sh
Обновите список шаблонов в интерфейсе платформы: раздел Шаблоны → кнопка Проверить обновления.
Установка из виртуальной машиныLink to Установка из виртуальной машины
Установка платформы
Импортируйте образ ВМ с ПО платформы в систему виртуализации KVM. Порядок импорта зависит от используемой системы виртуализации. 
Запустите ВМ.
Подключитесь к ВМ по SSH с параметрами:
имя пользователя — root
пароль — q1w2e3r4
Задайте необходимые сетевые настройки. 


По умолчанию IP-адрес для ВМ назначается через DHCP. Чтобы выполнять операции с серверами через PXE, настройте на ВМ статический IP-адрес.

Запустите скрипт установки: 

sh /root/install.sh
Дождитесь окончания установки. Если установка завершилась успешно, то в терминале будет выведена ссылка для перехода в платформу.

Перейдите в интерфейс платформы по полученной ссылке и укажите данные авторизации:
имя пользователя — admin@example.com
пароль администратора — q1w2e3r4
Измените пароль администратора и пользователя root после установки платформы.
После установки платформа будет доступна по IP-адресу или доменному имени ВМ.

Настройка локации
Если в качестве сервера-локации будет использоваться ВМ с платформой, авторизуйтесь в платформе и выполните начальную настройку.

Если для сервера-локации будет использоваться отдельная ВМ:

Импортируйте диск виртуальной машины (ВМ) с ПО локации в систему виртуализации KVM. Порядок импорта зависит от используемой системы виртуализации. 
Запустите ВМ.
Подключитесь к ВМ по SSH с параметрами:
имя пользователя — root
пароль — q1w2e3r4
Задайте необходимые сетевые настройки.


По умолчанию IP-адрес для ВМ назначается через DHCP. Чтобы выполнять операции с серверами через PXE, настройте на ВМ статический IP-адрес.

Пример установки для VMWare ESXi 6.7
Для импорта в VMWare образ состоит из следующих файлов:

ПО платформы (архив master.tar.gz):
master-0.vmdk — файл диска ВМ;
master.ovf — описание образа ВМ;
master.mf — список файлов в архиве и их контрольные суммы;
ПО локации (архив location.tar.gz):
location-0.vmdk — файл диска ВМ;
location.ovf — описание образа ВМ;
location.mf — список файлов в архиве и их контрольные суммы.
Порядок импорта:

Распакуйте архивы с ПО платформы и локации.
Нажмите кнопку Create/Register VM.

Выберите пункт Deploy a virtual machine from an OVF or OVA file.
Нажмите кнопку Next.

В поле Enter a name for the virtual machine введите название ВМ.
Нажмите в поле Click to select files or drag/drop и выберите файлы из архива с ПО платформы:
master-0.vmdk;
master.ovf;
master.mf.
Нажмите кнопку Next.

Выберите хранилище.
Нажмите кнопку Next.

Выберите настройки для развёртывания.
Нажмите кнопку Next.

Проверьте заданные настройки. Если настройки указаны верно, нажмите кнопку Finish.
Если для сервера-локации будет использоваться отдельная ВМ, повторите пп. 2-12 для ПО локации.
Загрузка шаблонов ОСLink to Загрузка шаблонов ОС
Чтобы загрузить шаблон:

Добавьте шаблон на локацию. Для этого перейдите на главную страницу → блок созданной локации → Настроить локацию:
Включите опцию Настроить параметры для выполнения операций над серверами через PXE.
В поле ОС выберите нужные шаблоны.
Нажмите Применить.

Укажите локальный репозиторий для шаблонов ОС семейства Linux. Для этого перейдите в Шаблоны → Шаблоны ОС → выберите шаблон:
Измените значение макроса $MIRROR на URL вида:
для Astra Linux — http://<IP-адрес сервера>:8080
для AlmaLinux — http://<IP-адрес сервера>:8080/almalinux
Нажмите Применить.
