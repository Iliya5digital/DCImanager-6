Диагностика в DCImanager 6 используется для проверки состояния сервера и его подготовки к использованию новым клиентом. В ходе диагностики:

проверяются характеристики оборудования;
проводится анализ S.M.A.R.T. дисков на наличие ошибок;
проверяется скорость локального соединения, чтобы исключить ошибки работы сетевой карты;
при необходимости проводится настройка BMC и очистка жёстких дисков сервера.
Информация о результатах диагностики вносится в базу данных DCImanager 6.

Часть программного обеспечения (ПО) и сторонних сервисов, используемых для проведения диагностики, установлена на сервере с DCImanager 6, часть — на локации. Подробнее о локациях см. в статье Локации. Общая информация.

Процесс диагностики можно разделить на следующие этапы:

Подготовка шаблона диагностики.

Загрузка шаблона диагностики.

Проведение диагностики.

Завершение диагностики.

Диагностика проходит по шаблону Diag6 на основе ОС SystemRescueCD 6.

ПО загружается на сервер по TFTP и HTTP. HTTP и TFTP-сервер, с которых происходит загрузка, расположены на локации.

В процессе диагностики на сервер передаются сетевые настройки с DHCP-сервера локации и загружается операционная система SystemRescueCD. По окончании диагностики загруженное ПО будет удалено, сетевые настройки сервера будут восстановлены в исходное состояние.

Если у платформы настроена интеграция с биллинговой системой, то на время диагностики серверу будет выделен IP-адрес из пула для освобождения серверов.

Сетевые настройки с DHCP-сервера передаются на канальном уровне (L2), дальнейшее взаимодействие по протоколам TFTP и HTTP происходит на сетевом уровне (L3).

Максимальное время, выделяемое на проведение диагностики — 60 минут. Если в течение этого времени диагностика не закончится, DCImanager 6 принудительно завершит операцию диагностики.

Подготовка шаблона диагностикиLink to Подготовка шаблона диагностики
На этом этапе DCImanager 6:

Формирует значения параметров и макросов для шаблона диагностики.
Настраивает конфигурационный файл DHCP-сервера.
Подготавливает файлы для передачи по TFTP и HTTP.
Генерирует новый пароль подключения к BMC, если вы включили опцию Настроить BMC.
Загрузка шаблона диагностикиLink to Загрузка шаблона диагностики
На этом этапе:

DCImanager 6 перезагружает диагностируемый сервер.
DHCP-сервер передаёт на диагностируемый сервер сетевые настройки и пути к файлам для передачи по TFTP.
Диагностируемый сервер скачивает по TFTP конфигурационный файл iPXE-загрузчика ipxe.conf.
DHCP-сервер передаёт сетевые настройки для iPXE-загрузчика на диагностируемом сервере.
iPXE-загрузчик скачивает по HTTP необходимые файлы для запуска диагностики и образ операционной системы SystemRescueCD. По окончании загружает SystemRescueCD в оперативную память.
DHCP-сервер передаёт сетевые настройки на диагностируемый сервер для работы SystemRescueCD.
Проведение диагностикиLink to Проведение диагностики
После загрузки шаблона происходит запуск скрипта диагностики autorun. Скрипт autorun:

Собирает информацию об оборудовании сервера и его производительности.
Отправляет собранные данные на локацию.
Производит очистку жёстких дисков при одном из условий:
если вы включили опцию Очистить SSD и HDD диски во время диагностики;
если в шаблон диагностики добавлен макрос $CLEAR_HDD или $FULL_HDD_CLEAR со значением "YES". Подробнее см. Макросы шаблонов.
Производит конфигурацию BMC, если вы включили опцию Настроить BMC:
Выделяет для BMC IP-адрес. Если подключение к BMC не настроено, IP-адрес будет выделен из пула, выбранного в настройках диагностики.
Изменяет пароль пользователя, под которым происходит подключение.
Отключает остальных пользователей BMC.
Перезагружает сервер.
Завершение диагностикиLink to Завершение диагностики
На этом этапе DCImanager 6:

Получает с локации данные, собранные в процессе диагностики.
Возвращает изменённые конфигурационные файлы в исходное состояние.
Удаляет директории и файлы, созданные для операции диагностики.
Сохраняет в базу данных конфигурацию сервера.
Перезагружает диагностируемый сервер для восстановления его прежнего состояния.
