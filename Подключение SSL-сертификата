Чтобы сервер с платформой был доступен по протоколу HTTPS, вам понадобится SSL-сертификат. Вы можете указать данные сертификата при установке платформы или подключить его позднее. Чтобы приобрести SSL-сертификат, обратитесь в любой сервис выдачи сертификатов или выпустите бесплатный сертификат Let’s Encrypt. Подробнее о Let's Encrypt см. в официальной документации.

В статье описан порядок подключения и замены SSL-сертификата.

Подключение сертификата при установке платформыLink to Подключение сертификата при установке платформы
Скопируйте файлы сертификата на сервер с DCImanager 6. Например, в директорию /root/.
При установке платформы укажите путь к файлам с открытым и приватным ключом SSL-сертификата в параметрах ssl-crt-file и ssl-key-file: 

Пример команды

./dci install -l="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" --ssl-crt-file="/root/example.crt" --ssl-key-file="/root/example.key"
Данные сертификата будут добавлены в настройки веб-сервера.


Файлы сертификата будут скопированы в директорию /opt/ispsystem/dci/ssl/. Для корректной работы платформы файлы должны храниться в этой директории.

Подключение сертификата после установки платформыLink to Подключение сертификата после установки платформы
Скопируйте файлы сертификата на сервер с DCImanager 6. Например, в директорию /root/.


После подключения файлы сертификата должны оставаться в этой директории с теми же именами. 

Подключитесь к серверу с DCImanager 6 по SSH.
Создайте файл patch_add_ssl.yaml со следующим содержанием: 

version: "3.7"
services:
  input:
    volumes:
      - /root/dci.crt:/etc/ssl/certs/default.domain.crt
      - /root/dci.key:/etc/ssl/private/default.domain.key
 Пояснения
/root/dci.crt — путь и имя файла SSL-сертификата

/root/dci.key — путь и имя файла ключа к SSL-сертификату


Не изменяйте значения /etc/ssl/certs/default.domain.crt и /etc/ssl/private/default.domain.key — это пути к сертификату внутри докер-контейнера.

Выполните команду: 

dci add-patch -f patch_add_ssl.yaml -p add_ssl
Укажите доменное имя сервера в параметре DomainName конфигурационного файла /opt/ispsystem/dci/config.json:

Пример файла config.json

{"MysqlRootPassword":"password","LicenseToken":"token","DomainName":"example.com","CurrentVersion":"6.14.0","UpdateDate":1616262495}
Остановите докер-контейнеры:

dci down
Запустите DCImanager 6:

dci start
Замена сертификатаLink to Замена сертификата
Замените старые файлы сертификата на актуальные. У новых файлов должны быть такие же имена, как у старых.
Остановите докер-контейнеры:

dci down
Запустите DCImanager 6:

dci start
