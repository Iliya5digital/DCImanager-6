Чтобы установить платформу на сервер без доступа к сети Интернет, выполните инструкции из статьи Установка в закрытом информационном контуре.

Для установки DCImanager 6 потребуется информация о лицензии. Если вы приобрели DCImanager 6 в ISPsystem, вы можете посмотреть эту информацию в личном кабинете на my.ispsystem.com в разделе "Лицензии". Для установки потребуется значение из поля Token.

Перед установкой платформы:

Убедитесь, что сервер соответствует системным требованиям. Подробнее см. в статье Требования к серверу.
Выполните инструкции из статьи Подготовка сервера.
Установка платформыLink to Установка платформы
Подключитесь к серверу по SSH с правами суперпользователя (по умолчанию root).

Скачайте установщик:

curl -O https://download.ispsystem.com/6/dci/dcibox/dci
Сделайте его исполняемым:

chmod +x dci
Запустите установку, используя ключ активации (токен) лицензии:

./dci install -l="<token>"
Пояснения к команде:

<token> — значение параметра Token для вашей лицензии. Отображается в личном кабинете my.ispsystem.com на странице подробной информации о лицензии.

 Дополнительные параметры
Дополнительные параметры команды:

-n — доменное имя сервера. Будет использовано в URL платформы; 

Пример команды

./dci install -l="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" -n="dcimanager.example.com"
--registry-port — TCP-порт для загрузки образов docker-контейнеров. Используйте параметр, если на сервере запрещены входящие подключения на порты 5000/tcp и 443/tcp; 

Пример команды

./dci install -l="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" --registry-port=5001
-f — не проверять версию Docker;
--ssl-crt-file, --ssl-key-file  — путь к файлам с открытым и приватным ключом SSL-сертификата. Данные будут добавлен в настройки веб-сервера;

Пример команды

./dci install -l="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" --ssl-crt-file="/root/example.crt" --ssl-key-file="/root/example.key"
--proxy — настройки HTTP-прокси в формате http://<user>:<password>@<address>:<port>:
<user> — имя пользователя для авторизации. Необязательный параметр;
<password> — пароль для авторизации. Необязательный параметр;
<address> — IP-адрес HTTP-прокси;
<port> — порт HTTP-прокси.

Пример команды для прокси с авторизацией

./dci install -l="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" --proxy="http://admin:pass123@192.168.57.1:3128"
Пример команды для прокси без авторизации

./dci install -l="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" --proxy="http://192.168.57.1:3128"
Установщик проверит версию ПО Docker на сервере. Если версия ниже 20.10.10, установка завершится с ошибкой. Чтобы установить платформу на сервер с более старой версией Docker, добавьте в команду установки параметр -f:

Пример команды

./dci install -l="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" -f
Дождитесь окончания установки. Если установка завершилась успешно, то в терминале будет выведена ссылка для перехода в DCImanager 6:

Терминал после успешной установки

Link to administrator registration page: https://127.0.0.1/auth/setup?token=C50A0BFA55DEDE3343AABE713022A15F

Обратите внимание!

При открытии ссылки браузер выдаст предупреждение о вероятной угрозе безопасности. Это происходит, если сервер использует самоподписанный SSL-сертификат. Вы можете подключить валидный SSL-сертификат к платформе по инструкции.

Перейдите в интерфейс DCImanager 6 по полученной ссылке и создайте первого пользователя:
Введите E-Mail пользователя.
Придумайте Пароль или нажмите генерировать для автоматической генерации пароля.
Нажмите Готово.
Выполните начальную настройку платформы.
Если у вас есть сертификат на дополнительный пакет ресурсов, активируйте его:
Перейдите в → Обзор системы → Активировать пакет.
Введите код из сертификата на пакет ресурсов.
Нажмите Активировать.


Подробнее о пакетах ресурсов см. в статье Лицензирование.
После установки платформа будет доступна по IP-адресу или доменному имени вашего сервера. Установщик запустится как systemd-сервис.


Обратите внимание!

Для работы DCImanager 6 используется система виртуализации Docker. По умолчанию она использует сети 172.17.0.0/12. Если ваше оборудование использует адреса из этих сетей, вы можете изменить настройки Docker. Подробнее см. в статье Как изменить сеть, используемую Docker?

Переустановка платформыLink to Переустановка платформы
Создайте новое значение Token для вашей лицензии. Вы можете сделать это в личном кабинете на my.ispsystem.com или обратиться в техническую поддержку.
Остановите платформу: 

dci down
Удалите директории /opt/ispsystem/dci и /var/lib/mysql: 

rm /opt/ispsystem/dci /var/lib/mysql -rf
Перезапустите сервис dci:

systemctl restart dci
Установите платформу: 

dci install -l="<new_token>"
Пояснения к команде:

<new_token> — новое значение параметра Token для вашей лицензии.

ЛогированиеLink to Логирование
Лог установки DCImanager 6 записывается в файл /opt/ispsystem/dci/install.log.
